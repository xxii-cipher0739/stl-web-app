<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<body>
<h1 sec:authorize="hasRole('COLLECTOR') || hasRole('DISPATCHER')" class="h6">Balance: ₱<span th:text="${walletBalance}"></span></h1>
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Bets</h1>
    <div class="btn-toolbar mb-2 mb-md-0" sec:authorize="hasRole('COLLECTOR')">
        <a th:href="@{/bets/add}" class="btn btn-sm btn-success">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
            </svg>
            Place Bet
        </a>
    </div>
</div>

<div class="alert alert-success alert-dismissible fade show" th:if="${successMessage}" role="alert">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
    </svg>
    <span th:text="${successMessage}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
<div class="alert alert-danger alert-dismissible fade show" th:if="${errorMessage}" role="alert">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
        <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
    </svg>
    <span th:text="${errorMessage}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered table-sm">
        <thead>
        <tr>
            <th scope="col">Reference</th>
            <th scope="col" sec:authorize="hasRole('ADMIN')">Created By</th>
            <th scope="col">Game & Schedule</th>
            <th scope="col">Bettor</th>
            <th scope="col">Amount</th>
            <th scope="col">Number Picks</th>
            <th scope="col">Date Created</th>
            <th scope="col">Status</th>
            <th scope="col" sec:authorize="hasRole('COLLECTOR')">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="bet : ${betList}">
            <td th:text="${bet.reference}"></td>
            <td sec:authorize="hasRole('ADMIN')">
                <span th:each="user : ${users}" th:if="${user.id == bet.createdBy}" th:text="${user.name}"></span>
            </td>
            <td th:text="${bet.gameType + ' (' + #temporals.format(bet.gameSchedule, 'EE, MMM dd, yyyy hh:mm a') + ')'}"></td>
            <td th:text="${bet.bettor}"></td>
            <td>
                ₱ <span th:text="${bet.amount}"></span>
            </td>
            <td th:text="${bet.betNumbers}"></td>
            <td th:text="${#temporals.format(bet.dateTimeCreated, 'EE, MMM dd, yyyy hh:mm:ss a')}"></td>
            <td>
                <span th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).PLACED}" class="badge bg-primary">Placed</span>
                <span th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).CANCELLED}" class="badge bg-secondary">Cancelled</span>
                <span th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).CONFIRMED}" class="badge bg-secondary">Confirmed</span>
                <span th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).WON}" class="badge bg-success">Won</span>
                <span th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).LOST}" class="badge bg-danger">Lost</span>
            </td>
            <td sec:authorize="hasRole('COLLECTOR')">
                <a th:href="@{/bets/edit/{id}(id=${bet.id})}" class="btn btn-sm btn-primary"
                   th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).PLACED}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16">
                        <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001m-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708z"/>
                    </svg>
                    Edit
                </a>
                <a th:href="@{/bets/confirm/{id}(id=${bet.id})}" class="btn btn-sm btn-success"
                   th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).PLACED}"
                   onclick="return confirm('Are you sure you want to confirm this bet?');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                        <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
                    </svg>
                    Confirm
                </a>
                <a th:href="@{/bets/cancel/{id}(id=${bet.id})}" class="btn btn-sm btn-secondary"
                   th:if="${bet.status == T(xyz.playground.stl_web_app.Constants.BetStatus).PLACED}"
                   onclick="return confirm('Are you sure you want to cancel this bet?');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                    </svg>
                    Cancel
                </a>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(betList)}">
            <td colspan="7" class="text-center">No bets found</td>
        </tr>
        </tbody>
    </table>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-dismiss alerts after 5 seconds (5000 milliseconds)
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            setTimeout(function() {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }, 5000);
        });
    });
</script>
</body>
</html>
